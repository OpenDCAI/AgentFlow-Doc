import{_ as n,c as e,a,o as t}from"./app-BSBZkIGC.js";const d={};function i(l,s){return t(),e("div",null,[...s[0]||(s[0]=[a(`<p>This document describes the overall architecture of AgentFlow, covering all three major modules: <strong>Synthesis</strong>, <strong>Rollout</strong>, and <strong>Sandbox</strong>.</p><h2 id="architecture-overview" tabindex="-1"><a class="header-anchor" href="#architecture-overview"><span>Architecture Overview</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>+=========================================================================+</span></span>
<span class="line"><span>|                          AgentFlow Framework                            |</span></span>
<span class="line"><span>+=========================================================================+</span></span>
<span class="line"><span>|                                                                         |</span></span>
<span class="line"><span>|  +---------------------------+    +------------------------------+      |</span></span>
<span class="line"><span>|  |      Synthesis Module     |    |       Rollout Module         |      |</span></span>
<span class="line"><span>|  |---------------------------|    |------------------------------|      |</span></span>
<span class="line"><span>|  | synthesize()              |    | rollout()                    |      |</span></span>
<span class="line"><span>|  | load_config()             |    | quick_rollout()              |      |</span></span>
<span class="line"><span>|  | load_seeds()              |    | load_config()                |      |</span></span>
<span class="line"><span>|  |                           |    | load_tasks()                 |      |</span></span>
<span class="line"><span>|  |  +---------------------+  |    |  +------------------------+  |      |</span></span>
<span class="line"><span>|  |  | SynthesisPipeline   |  |    |  | RolloutPipeline        |  |      |</span></span>
<span class="line"><span>|  |  |---------------------|  |    |  |------------------------|  |      |</span></span>
<span class="line"><span>|  |  | Sampler             |  |    |  | AgentRunner            |  |      |</span></span>
<span class="line"><span>|  |  | Selector            |  |    |  | Evaluator              |  |      |</span></span>
<span class="line"><span>|  |  | Synthesizer         |  |    |  | BenchmarkItem          |  |      |</span></span>
<span class="line"><span>|  |  | Worker              |  |    |  +------------------------+  |      |</span></span>
<span class="line"><span>|  |  +---------------------+  |    |                              |      |</span></span>
<span class="line"><span>|  |                           |    |  +------------------------+  |      |</span></span>
<span class="line"><span>|  |  +---------------------+  |    |  | RolloutConfig          |  |      |</span></span>
<span class="line"><span>|  |  | SynthesisConfig     |  |    |  |------------------------|  |      |</span></span>
<span class="line"><span>|  |  |---------------------|  |    |  | Model settings         |  |      |</span></span>
<span class="line"><span>|  |  | Sampling params     |  |    |  | Evaluation settings    |  |      |</span></span>
<span class="line"><span>|  |  | Selection params    |  |    |  | Sandbox connection     |  |      |</span></span>
<span class="line"><span>|  |  | Model settings      |  |    |  | Task configuration     |  |      |</span></span>
<span class="line"><span>|  |  | Sandbox connection  |  |    |  +------------------------+  |      |</span></span>
<span class="line"><span>|  |  +---------------------+  |    |                              |      |</span></span>
<span class="line"><span>|  +---------------------------+    +------------------------------+      |</span></span>
<span class="line"><span>|              |                                |                         |</span></span>
<span class="line"><span>|              |     Sandbox Server URL         |                         |</span></span>
<span class="line"><span>|              +---------------+----------------+                         |</span></span>
<span class="line"><span>|                              |                                          |</span></span>
<span class="line"><span>|  +---------------------------------------------------------------+     |</span></span>
<span class="line"><span>|  |                      Sandbox Module                            |     |</span></span>
<span class="line"><span>|  |---------------------------------------------------------------|     |</span></span>
<span class="line"><span>|  |                                                                |     |</span></span>
<span class="line"><span>|  |  +------------------+          +----------------------------+  |     |</span></span>
<span class="line"><span>|  |  | Sandbox (Facade) |  HTTP    | HTTPServiceServer (FastAPI)|  |     |</span></span>
<span class="line"><span>|  |  |   Client Side    | -------&gt; |       Server Side          |  |     |</span></span>
<span class="line"><span>|  |  +------------------+          +----------------------------+  |     |</span></span>
<span class="line"><span>|  |                                   |                            |     |</span></span>
<span class="line"><span>|  |                    +--------------+--------------+             |     |</span></span>
<span class="line"><span>|  |                    |                             |             |     |</span></span>
<span class="line"><span>|  |             +------+------+            +---------+--------+   |     |</span></span>
<span class="line"><span>|  |             | ToolExecutor|            | ResourceRouter   |   |     |</span></span>
<span class="line"><span>|  |             +------+------+            +---------+--------+   |     |</span></span>
<span class="line"><span>|  |                    |                             |             |     |</span></span>
<span class="line"><span>|  |  +-----------------------------------------------------+     |     |</span></span>
<span class="line"><span>|  |  |              Backend System                          |     |     |</span></span>
<span class="line"><span>|  |  |  +------+ +-----+ +------+ +---------+ +----------+ |     |     |</span></span>
<span class="line"><span>|  |  |  |  VM  | | RAG | | Bash | | Browser | | CodeExec | |     |     |</span></span>
<span class="line"><span>|  |  |  +------+ +-----+ +------+ +---------+ +----------+ |     |     |</span></span>
<span class="line"><span>|  |  |  +----------+ +--------+                             |     |     |</span></span>
<span class="line"><span>|  |  |  | WebSearch| | Doc    |  ... (extensible)           |     |     |</span></span>
<span class="line"><span>|  |  |  +----------+ +--------+                             |     |     |</span></span>
<span class="line"><span>|  |  +-----------------------------------------------------+     |     |</span></span>
<span class="line"><span>|  +---------------------------------------------------------------+     |</span></span>
<span class="line"><span>+=========================================================================+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="module-details" tabindex="-1"><a class="header-anchor" href="#module-details"><span>Module Details</span></a></h2><h3 id="synthesis-module" tabindex="-1"><a class="header-anchor" href="#synthesis-module"><span>Synthesis Module</span></a></h3><p>The Synthesis module implements the three-stage data synthesis pipeline: Trajectory Sampling, Trajectory Selection, and QA Synthesis. It is the primary interface for generating agent training data.</p><h4 id="components" tabindex="-1"><a class="header-anchor" href="#components"><span>Components</span></a></h4><table><thead><tr><th>Component</th><th>Location</th><th>Responsibility</th></tr></thead><tbody><tr><td><strong><code>synthesize()</code></strong></td><td><code>synthesis/api.py</code></td><td>One-call public API; loads config, loads seeds, runs the full pipeline</td></tr><tr><td><strong><code>load_config()</code></strong></td><td><code>synthesis/api.py</code></td><td>Loads <code>SynthesisConfig</code> from JSON or YAML files</td></tr><tr><td><strong><code>load_seeds()</code></strong></td><td><code>synthesis/api.py</code></td><td>Loads seed data from JSONL files, string lists, or dict lists</td></tr><tr><td><strong>SynthesisPipeline</strong></td><td><code>synthesis/pipeline.py</code></td><td>Orchestrates the three-stage pipeline end to end</td></tr><tr><td><strong>Sampler</strong></td><td><code>synthesis/core/sampler.py</code></td><td>Builds branching trajectory trees via LLM-driven exploration</td></tr><tr><td><strong>Selector</strong></td><td><code>synthesis/core/selector.py</code></td><td>Scores and selects high-quality root-to-leaf paths</td></tr><tr><td><strong>Synthesizer</strong></td><td><code>synthesis/core/synthesizer.py</code></td><td>Generates multi-hop QA pairs from selected trajectories</td></tr><tr><td><strong>Worker</strong></td><td><code>synthesis/core/worker.py</code></td><td>Manages parallel seed processing workers</td></tr><tr><td><strong>SynthesisConfig</strong></td><td><code>synthesis/core/config.py</code></td><td>Dataclass configuration with validation and serialization</td></tr></tbody></table><h4 id="configuration-parameters" tabindex="-1"><a class="header-anchor" href="#configuration-parameters"><span>Configuration Parameters</span></a></h4><table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>seeds_file</code></td><td><code>None</code></td><td>Path to seed data file (JSONL)</td></tr><tr><td><code>output_dir</code></td><td><code>None</code></td><td>Output directory for synthesized data</td></tr><tr><td><code>available_tools</code></td><td><code>[]</code></td><td>List of sandbox tools the agent can use</td></tr><tr><td><code>model_name</code></td><td><code>&quot;gpt-4.1-2025-04-14&quot;</code></td><td>LLM model for trajectory sampling and QA generation</td></tr><tr><td><code>max_depth</code></td><td><code>5</code></td><td>Maximum depth of the trajectory tree</td></tr><tr><td><code>branching_factor</code></td><td><code>2</code></td><td>Number of branches at each tree node</td></tr><tr><td><code>depth_threshold</code></td><td><code>3</code></td><td>Depth threshold for branching behavior</td></tr><tr><td><code>min_depth</code></td><td><code>2</code></td><td>Minimum trajectory depth for selection</td></tr><tr><td><code>max_selected_traj</code></td><td><code>3</code></td><td>Maximum number of selected trajectories per seed</td></tr><tr><td><code>path_similarity_threshold</code></td><td><code>0.7</code></td><td>Deduplication threshold for path similarity</td></tr><tr><td><code>number_of_seed</code></td><td><code>None</code></td><td>Limit on number of seeds to process</td></tr><tr><td><code>sandbox_server_url</code></td><td><code>&quot;http://127.0.0.1:18890&quot;</code></td><td>URL of the sandbox server</td></tr><tr><td><code>sandbox_auto_start</code></td><td><code>True</code></td><td>Whether to auto-start the sandbox server</td></tr></tbody></table><hr><h3 id="rollout-module" tabindex="-1"><a class="header-anchor" href="#rollout-module"><span>Rollout Module</span></a></h3><p>The Rollout module drives agent inference on benchmark tasks and provides built-in evaluation. It supports both batch execution on datasets and quick single-question mode.</p><h4 id="components-1" tabindex="-1"><a class="header-anchor" href="#components-1"><span>Components</span></a></h4><table><thead><tr><th>Component</th><th>Location</th><th>Responsibility</th></tr></thead><tbody><tr><td><strong><code>rollout()</code></strong></td><td><code>rollout/api.py</code></td><td>One-call public API; loads config, applies overrides, runs the pipeline</td></tr><tr><td><strong><code>quick_rollout()</code></strong></td><td><code>rollout/api.py</code></td><td>Single-question mode for rapid testing</td></tr><tr><td><strong><code>load_config()</code></strong></td><td><code>rollout/api.py</code></td><td>Loads <code>RolloutConfig</code> from JSON or YAML files</td></tr><tr><td><strong><code>load_tasks()</code></strong></td><td><code>rollout/api.py</code></td><td>Loads benchmark tasks from file or list</td></tr><tr><td><strong>RolloutPipeline</strong></td><td><code>rollout/pipeline.py</code></td><td>Orchestrates task execution, evaluation, and result saving</td></tr><tr><td><strong>AgentRunner</strong></td><td><code>rollout/core/runner.py</code></td><td>Executes individual agent tasks with tool calls against the sandbox</td></tr><tr><td><strong>Evaluator</strong></td><td><code>rollout/core/evaluator.py</code></td><td>Scores agent outputs with configurable metrics</td></tr><tr><td><strong>BenchmarkItem</strong></td><td><code>rollout/core/models.py</code></td><td>Data model for benchmark tasks</td></tr><tr><td><strong>RolloutConfig</strong></td><td><code>rollout/core/config.py</code></td><td>Dataclass configuration with validation and serialization</td></tr></tbody></table><h4 id="configuration-parameters-1" tabindex="-1"><a class="header-anchor" href="#configuration-parameters-1"><span>Configuration Parameters</span></a></h4><table><thead><tr><th>Parameter</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>data_path</code></td><td><code>None</code></td><td>Path to benchmark data file (JSONL)</td></tr><tr><td><code>output_dir</code></td><td><code>None</code></td><td>Output directory for results</td></tr><tr><td><code>model_name</code></td><td><code>&quot;gpt-4.1-2025-04-14&quot;</code></td><td>LLM model for agent inference</td></tr><tr><td><code>max_turns</code></td><td><code>100</code></td><td>Maximum conversation turns per task</td></tr><tr><td><code>max_retries</code></td><td><code>3</code></td><td>Maximum retries per LLM call</td></tr><tr><td><code>max_workers</code></td><td><code>1</code></td><td>Number of parallel workers</td></tr><tr><td><code>available_tools</code></td><td><code>[]</code></td><td>List of sandbox tools the agent can use</td></tr><tr><td><code>system_prompt</code></td><td><code>&quot;&quot;</code></td><td>Custom system prompt for the agent</td></tr><tr><td><code>evaluate_results</code></td><td><code>True</code></td><td>Whether to run evaluation after inference</td></tr><tr><td><code>evaluation_metric</code></td><td><code>&quot;exact_match&quot;</code></td><td>Metric: <code>exact_match</code>, <code>f1_score</code>, <code>contains_answer</code>, <code>numeric_match</code>, <code>similarity</code>, <code>llm_judgement</code></td></tr><tr><td><code>sandbox_server_url</code></td><td><code>&quot;http://127.0.0.1:18890&quot;</code></td><td>URL of the sandbox server</td></tr><tr><td><code>sandbox_auto_start</code></td><td><code>False</code></td><td>Whether to auto-start the sandbox server</td></tr><tr><td><code>save_trajectories</code></td><td><code>True</code></td><td>Whether to save full conversation trajectories</td></tr><tr><td><code>parallel</code></td><td><code>False</code></td><td>Whether to enable parallel task execution</td></tr></tbody></table><hr><h3 id="sandbox-module" tabindex="-1"><a class="header-anchor" href="#sandbox-module"><span>Sandbox Module</span></a></h3><p>The Sandbox module provides the unified execution environment that both the Synthesis and Rollout modules depend on. It manages resource backends, session lifecycles, and tool execution through a client-server architecture.</p><h4 id="components-2" tabindex="-1"><a class="header-anchor" href="#components-2"><span>Components</span></a></h4><table><thead><tr><th>Component</th><th>Location</th><th>Responsibility</th></tr></thead><tbody><tr><td><strong>Sandbox</strong> (Facade)</td><td><code>sandbox/sandbox.py</code></td><td>Unified client-side entry point; wraps HTTP client; supports sync/async</td></tr><tr><td><strong>HTTPServiceClient</strong></td><td><code>sandbox/client.py</code></td><td>HTTP request wrapper with worker ID management and auto retry</td></tr><tr><td><strong>HTTPServiceServer</strong></td><td><code>sandbox/server/app.py</code></td><td>FastAPI server; holds backends; registers tools; dispatches requests</td></tr><tr><td><strong>ToolExecutor</strong></td><td><code>sandbox/server/core/tool_executor.py</code></td><td>Parses resource-type prefixes, injects sessions, manages temporary sessions</td></tr><tr><td><strong>ResourceRouter</strong></td><td><code>sandbox/server/core/resource_router.py</code></td><td>Session lifecycle management; worker resource isolation</td></tr><tr><td><strong>Backend</strong> (base)</td><td><code>sandbox/server/backends/base.py</code></td><td>Abstract base class for all resource backends</td></tr><tr><td><strong>VMBackend</strong></td><td><code>sandbox/server/backends/resources/vm.py</code></td><td>Virtual machine desktop automation</td></tr><tr><td><strong>RAGBackend</strong></td><td><code>sandbox/server/backends/resources/rag.py</code></td><td>Document retrieval service</td></tr><tr><td><strong>WebSearch</strong></td><td><code>sandbox/server/backends/tools/websearch.py</code></td><td>Web search and page visit API tools</td></tr><tr><td><strong>Doc Tool</strong></td><td><code>sandbox/server/backends/tools/doc_tool.py</code></td><td>Document processing API tool</td></tr><tr><td><strong>Text2SQL Tool</strong></td><td><code>sandbox/server/backends/tools/text2sql_tool.py</code></td><td>SQL database query API tool</td></tr><tr><td><strong>DS Tool</strong></td><td><code>sandbox/server/backends/tools/ds_tool.py</code></td><td>Data science / analysis API tool</td></tr></tbody></table><h4 id="backend-types" tabindex="-1"><a class="header-anchor" href="#backend-types"><span>Backend Types</span></a></h4><table><thead><tr><th>Backend</th><th>Resource Type</th><th>Session Model</th><th>Description</th></tr></thead><tbody><tr><td><strong>VM</strong></td><td>Session</td><td>One VM per worker</td><td>Desktop automation via screenshot, click, type, scroll</td></tr><tr><td><strong>RAG</strong></td><td>Shared</td><td>Shared across workers</td><td>Document retrieval and knowledge base search</td></tr><tr><td><strong>Bash</strong></td><td>Session</td><td>One shell per worker</td><td>Command line interaction</td></tr><tr><td><strong>Browser</strong></td><td>Hybrid</td><td>Session + shared pool</td><td>Web page automation and navigation</td></tr><tr><td><strong>Code Executor</strong></td><td>Session</td><td>One sandbox per worker</td><td>Sandboxed code execution</td></tr><tr><td><strong>WebSearch</strong></td><td>API Tool</td><td>Stateless</td><td>Web search (Serper) and page visit (Jina Reader)</td></tr></tbody></table><hr><h2 id="data-flow" tabindex="-1"><a class="header-anchor" href="#data-flow"><span>Data Flow</span></a></h2><h3 id="synthesis-pipeline-data-flow" tabindex="-1"><a class="header-anchor" href="#synthesis-pipeline-data-flow"><span>Synthesis Pipeline Data Flow</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>Seeds (JSONL)</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    v</span></span>
<span class="line"><span>+-------------------+</span></span>
<span class="line"><span>| SynthesisPipeline  |</span></span>
<span class="line"><span>+-------------------+</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    |  Stage 1: Trajectory Sampling</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |  | Sampler                                   |</span></span>
<span class="line"><span>    |  |  seed --&gt; LLM proposes tool call           |</span></span>
<span class="line"><span>    |  |       --&gt; Sandbox executes tool             |</span></span>
<span class="line"><span>    |  |       --&gt; Observation recorded              |</span></span>
<span class="line"><span>    |  |       --&gt; Branch &amp; repeat (up to max_depth) |</span></span>
<span class="line"><span>    |  |  Result: trajectory tree per seed           |</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    |  Stage 2: Trajectory Selection</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |  | Selector                                  |</span></span>
<span class="line"><span>    |  |  Enumerate root-to-leaf paths              |</span></span>
<span class="line"><span>    |  |  Score by depth, richness, diversity       |</span></span>
<span class="line"><span>    |  |  Deduplicate (path_similarity_threshold)   |</span></span>
<span class="line"><span>    |  |  Select top-k (max_selected_traj)          |</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    |  Stage 3: QA Synthesis</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |  | Synthesizer                               |</span></span>
<span class="line"><span>    |  |  Selected trajectory --&gt; LLM generates QA  |</span></span>
<span class="line"><span>    |  |  Quality checks applied                    |</span></span>
<span class="line"><span>    |  |  Result: multi-hop QA pairs                |</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    v</span></span>
<span class="line"><span>Output (JSONL: trajectories + QA pairs)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rollout-pipeline-data-flow" tabindex="-1"><a class="header-anchor" href="#rollout-pipeline-data-flow"><span>Rollout Pipeline Data Flow</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>Benchmark Data (JSONL)     Config (JSON/YAML)</span></span>
<span class="line"><span>    |                           |</span></span>
<span class="line"><span>    v                           v</span></span>
<span class="line"><span>+-----------------------------------------------+</span></span>
<span class="line"><span>| RolloutPipeline                                |</span></span>
<span class="line"><span>+-----------------------------------------------+</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    |  Task Execution</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |  | AgentRunner (per worker)                  |</span></span>
<span class="line"><span>    |  |  Load task (BenchmarkItem)                |</span></span>
<span class="line"><span>    |  |  Initialize sandbox session               |</span></span>
<span class="line"><span>    |  |  Loop (up to max_turns):                  |</span></span>
<span class="line"><span>    |  |    LLM generates response/tool call       |</span></span>
<span class="line"><span>    |  |    Sandbox executes tool                   |</span></span>
<span class="line"><span>    |  |    Record observation in trajectory        |</span></span>
<span class="line"><span>    |  |    If final answer: break                  |</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    |  Evaluation</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |  | Evaluator                                 |</span></span>
<span class="line"><span>    |  |  Compare predicted answer vs ground truth |</span></span>
<span class="line"><span>    |  |  Apply metric (EM / F1 / LLM judge / ...) |</span></span>
<span class="line"><span>    |  |  Aggregate scores                          |</span></span>
<span class="line"><span>    |  +------------------------------------------+</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    v</span></span>
<span class="line"><span>Results (JSON: answers + scores + trajectories)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sandbox-execution-flow" tabindex="-1"><a class="header-anchor" href="#sandbox-execution-flow"><span>Sandbox Execution Flow</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>Client (Synthesis/Rollout)</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    |  POST /session/create  { worker_id, resource_type, config }</span></span>
<span class="line"><span>    |  POST /execute          { worker_id, action, params }</span></span>
<span class="line"><span>    |  POST /session/destroy  { worker_id, resource_type }</span></span>
<span class="line"><span>    |</span></span>
<span class="line"><span>    v</span></span>
<span class="line"><span>+---------------------------------------------------------------+</span></span>
<span class="line"><span>| HTTPServiceServer (FastAPI)                                    |</span></span>
<span class="line"><span>|                                                                |</span></span>
<span class="line"><span>|   Request --&gt; ToolExecutor                                     |</span></span>
<span class="line"><span>|                  |                                              |</span></span>
<span class="line"><span>|                  +--&gt; Parse &quot;resource_type:action&quot; prefix       |</span></span>
<span class="line"><span>|                  +--&gt; ResourceRouter: locate/create session     |</span></span>
<span class="line"><span>|                  +--&gt; Backend: execute tool method              |</span></span>
<span class="line"><span>|                  +--&gt; Return standardized JSON response         |</span></span>
<span class="line"><span>|                                                                |</span></span>
<span class="line"><span>+---------------------------------------------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="lifecycle-management" tabindex="-1"><a class="header-anchor" href="#lifecycle-management"><span>Lifecycle Management</span></a></h2><h3 id="backend-lifecycle" tabindex="-1"><a class="header-anchor" href="#backend-lifecycle"><span>Backend Lifecycle</span></a></h3><table><thead><tr><th>Method</th><th>Trigger</th><th>Purpose</th></tr></thead><tbody><tr><td><code>warmup()</code></td><td>Server startup</td><td>Warm up shared resources (e.g., connection pools, model loading)</td></tr><tr><td><code>initialize()</code></td><td><code>POST /session/create</code></td><td>Allocate worker-specific resources (e.g., create VM, open shell)</td></tr><tr><td><code>cleanup()</code></td><td><code>POST /session/destroy</code></td><td>Reclaim worker resources (e.g., destroy VM, close shell)</td></tr><tr><td><code>shutdown()</code></td><td>Server shutdown</td><td>Release all shared resources and clean up globally</td></tr></tbody></table><h3 id="session-lifecycle" tabindex="-1"><a class="header-anchor" href="#session-lifecycle"><span>Session Lifecycle</span></a></h3><table><thead><tr><th>Phase</th><th>Description</th></tr></thead><tbody><tr><td><strong>Explicit Session</strong></td><td>Created via <code>create_session()</code>; persists across multiple <code>execute()</code> calls; destroyed via <code>destroy_session()</code></td></tr><tr><td><strong>Temporary Session</strong></td><td>Auto-created when <code>execute()</code> is called without a prior session; destroyed immediately after the call returns</td></tr><tr><td><strong>Worker Isolation</strong></td><td>Each worker ID has independent sessions; no cross-worker state leakage</td></tr></tbody></table><h2 id="project-structure" tabindex="-1"><a class="header-anchor" href="#project-structure"><span>Project Structure</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>AgentFlow/</span></span>
<span class="line"><span>|-- synthesis/                 # Synthesis Module</span></span>
<span class="line"><span>|   |-- api.py                 #   Public API: synthesize(), load_config(), load_seeds()</span></span>
<span class="line"><span>|   |-- pipeline.py            #   SynthesisPipeline orchestrator</span></span>
<span class="line"><span>|   +-- core/</span></span>
<span class="line"><span>|       |-- config.py          #   SynthesisConfig dataclass</span></span>
<span class="line"><span>|       |-- sampler.py         #   Trajectory tree sampling</span></span>
<span class="line"><span>|       |-- selector.py        #   Trajectory path selection</span></span>
<span class="line"><span>|       |-- synthesizer.py     #   QA pair generation</span></span>
<span class="line"><span>|       |-- worker.py          #   Parallel seed processing</span></span>
<span class="line"><span>|       |-- models.py          #   Data models</span></span>
<span class="line"><span>|       +-- utils.py           #   Utility functions</span></span>
<span class="line"><span>|</span></span>
<span class="line"><span>|-- rollout/                   # Rollout Module</span></span>
<span class="line"><span>|   |-- api.py                 #   Public API: rollout(), quick_rollout(), load_config()</span></span>
<span class="line"><span>|   |-- pipeline.py            #   RolloutPipeline orchestrator</span></span>
<span class="line"><span>|   +-- core/</span></span>
<span class="line"><span>|       |-- config.py          #   RolloutConfig dataclass</span></span>
<span class="line"><span>|       |-- runner.py          #   AgentRunner for task execution</span></span>
<span class="line"><span>|       |-- evaluator.py       #   Result evaluation with multiple metrics</span></span>
<span class="line"><span>|       |-- models.py          #   BenchmarkItem and result models</span></span>
<span class="line"><span>|       +-- utils.py           #   Utility functions</span></span>
<span class="line"><span>|</span></span>
<span class="line"><span>|-- sandbox/                   # Sandbox Module</span></span>
<span class="line"><span>|   |-- sandbox.py             #   Sandbox facade (client-side entry point)</span></span>
<span class="line"><span>|   |-- client.py              #   HTTPServiceClient</span></span>
<span class="line"><span>|   |-- protocol.py            #   Protocol definitions</span></span>
<span class="line"><span>|   |-- result_formatter.py    #   Response formatting</span></span>
<span class="line"><span>|   |-- server/</span></span>
<span class="line"><span>|   |   |-- app.py             #   HTTPServiceServer (FastAPI)</span></span>
<span class="line"><span>|   |   +-- core/</span></span>
<span class="line"><span>|   |       |-- tool_executor.py    # Tool execution engine</span></span>
<span class="line"><span>|   |       +-- resource_router.py  # Session and resource management</span></span>
<span class="line"><span>|   +-- server/backends/</span></span>
<span class="line"><span>|       |-- base.py            #   Backend abstract base class</span></span>
<span class="line"><span>|       |-- resources/</span></span>
<span class="line"><span>|       |   |-- vm.py          #   VM desktop backend</span></span>
<span class="line"><span>|       |   +-- rag.py         #   RAG retrieval backend</span></span>
<span class="line"><span>|       +-- tools/</span></span>
<span class="line"><span>|           |-- websearch.py   #   WebSearch API tool</span></span>
<span class="line"><span>|           |-- doc_tool.py    #   Document processing tool</span></span>
<span class="line"><span>|           |-- text2sql_tool.py   # SQL query tool</span></span>
<span class="line"><span>|           +-- ds_tool.py     #   Data science tool</span></span>
<span class="line"><span>|</span></span>
<span class="line"><span>|-- configs/                   # Configuration Files</span></span>
<span class="line"><span>|   |-- sandbox-server/        #   Sandbox server configs</span></span>
<span class="line"><span>|   |-- synthesis/             #   Synthesis pipeline configs</span></span>
<span class="line"><span>|   |-- trajectory/            #   Trajectory rollout configs</span></span>
<span class="line"><span>|   +-- infer/                 #   Inference configs</span></span>
<span class="line"><span>|</span></span>
<span class="line"><span>|-- benchmark/                 # Benchmark Datasets</span></span>
<span class="line"><span>|-- seeds/                     # Seed Data</span></span>
<span class="line"><span>+-- examples/                  # Example Scripts</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,39)])])}const o=n(d,[["render",i]]),p=JSON.parse('{"path":"/en/guide/architecture/","title":"Architecture Design","lang":"en-US","frontmatter":{"title":"Architecture Design","createTime":"2025/02/04 10:00:00","icon":"material-symbols:auto-transmission-sharp","permalink":"/en/guide/architecture/"},"readingTime":{"minutes":4.18,"words":1255},"git":{"createdTime":1770210864000,"updatedTime":1771412123000,"contributors":[{"name":"Jialong Wu","username":"","email":"jialong@JialongdeMacBook-Air.local","commits":1,"avatar":"https://gravatar.com/avatar/8b13955affa5cc83f8d0e72a08fcc5919d691747e429237ed1c21a8405ed8f19?d=retro"},{"name":"callanwu","username":"callanwu","email":"wujialongml@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/callanwu?v=4","url":"https://github.com/callanwu"},{"name":"Claude Opus 4.6","username":"","email":"noreply@anthropic.com","commits":1,"avatar":"https://gravatar.com/avatar/cd29c5ac348a026a3ec5286890908fffb5bf6ab77f20672171be323a70c95026?d=retro"}]},"filePathRelative":"en/notes/guide/basicinfo/architecture.md","headers":[]}');export{o as comp,p as data};
